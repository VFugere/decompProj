rm(list=ls())
par(family='sans')
options(scipen=999)
library(tidyverse)
library(RColorBrewer)
library(glmmTMB)
library(magrittr)
library(plotrix)
cols <- brewer.pal(3, 'Dark2')
data <- read_csv('~/Google Drive/Recherche/PhD/manuscripts/caterpillar/decompProj/leafbags.csv')
data$days <- data$weeks*7
dmg <-  read_csv('~/Google Drive/Recherche/PhD/manuscripts/caterpillar/decompProj/caterpillar.csv') %>%
select(leaf.nb,damage.area)
data <- inner_join(data, dmg, by = 'leaf.nb')
rm(dmg)
data$prop <- data$prct.mass.rem/100
data$prop.decomp <- 1-data$prop
#transformation based on: https://stats.stackexchange.com/questions/31300/dealing-with-0-1-values-in-a-beta-regression
data$rv <- 1-(data$prop*(nrow(data)-1)+0.5) / nrow(data)
data$dmg <- rescale(data$damage.area, c(0,1)) #so that range is similar to factors below
data$lu <- as.factor(data$land.use)
data$lu <- relevel(data$lu, ref = 'forest')
data$ha <- as.factor(data$leaf.deployment)
data$ha <- relevel(data$ha, ref = 'home')
fm <- filter(data, mesh.type == 'fine')
m0 <- glmmTMB(rv ~ 1 + weeks + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m1 <- glmmTMB(rv ~ 1 + weeks + weeks:lu + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m2 <- glmmTMB(rv ~ 1 + weeks + weeks:ha + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m3 <- glmmTMB(rv ~ 1 + weeks + weeks:dmg + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m4 <- glmmTMB(rv ~ 1 + weeks + weeks:dmg + weeks:ha + weeks:lu + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m5 <- glmmTMB(rv ~ 1 + weeks + weeks:ha*lu + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m6 <- glmmTMB(rv ~ 1 + weeks + weeks:ha*dmg + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
m7 <- glmmTMB(rv ~ 1 + weeks + weeks:dmg*lu + (weeks-1|site) + (weeks-1|leaf) + (weeks-1|leaf.origin), fm, family=beta_family(link = "logit"))
models.fm <- list(m0,m1,m2,m3,m4,m5,m6,m7)
summary(m4)
m4 <- glmmTMB(rv ~ 1 + weeks + weeks:dmg + weeks:ha + weeks:lu + (weeks|site) + (weeks|leaf) + (weeks|leaf.origin), fm, family=beta_family(link = "logit"))
summary(m4)
rm(list=ls())
